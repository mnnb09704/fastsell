<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fast Sell - Trusted Exchange</title>
    
    <!-- Error Handling Styles -->
    <style>
        #error-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 9999; padding: 20px; color: red; font-family: monospace; border-top: 5px solid red; }
        .loading { display: flex; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; color: #666; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.min.js"></script>
    
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'marquee': 'marquee 25s linear infinite',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        marquee: { '0%': { transform: 'translateX(100%)' }, '100%': { transform: 'translateX(-100%)' } }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-50 text-slate-800 transition-colors duration-300">
    
    <div id="error-overlay">
        <h2 style="font-size: 20px; font-weight: bold; margin-bottom: 10px;">System Error</h2>
        <pre id="error-msg" style="background: #f0f0f0; padding: 15px; border-radius: 8px; overflow: auto; font-size: 12px;"></pre>
    </div>

    <div id="root"><div class="loading">Loading Fast Sell...</div></div>

    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            document.getElementById('error-overlay').style.display = 'block';
            document.getElementById('error-msg').innerText = "Error: " + message + "\nLine: " + lineno;
        };
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const Icons = window.lucideReact || {};
        const getIcon = (name) => Icons[name] || (() => <span>?</span>);

        // Icons
        const ArrowRightLeft = getIcon('ArrowRightLeft');
        const Settings = getIcon('Settings');
        const User = getIcon('User');
        const Package = getIcon('Package');
        const CheckCircle = getIcon('CheckCircle');
        const Clock = getIcon('Clock');
        const Trash2 = getIcon('Trash2');
        const Copy = getIcon('Copy');
        const LogOut = getIcon('LogOut');
        const Bell = getIcon('Bell');
        const ShieldAlert = getIcon('ShieldAlert');
        const Sun = getIcon('Sun');
        const Moon = getIcon('Moon');
        const MessageCircle = getIcon('MessageCircle');
        const LayoutDashboard = getIcon('LayoutDashboard');
        const List = getIcon('List');
        const Sliders = getIcon('Sliders');
        const X = getIcon('X');
        const Menu = getIcon('Menu');
        const ArrowRight = getIcon('ArrowRight');
        const Wallet = getIcon('Wallet');
        const FileText = getIcon('FileText');
        const Phone = getIcon('Phone');
        const Plus = getIcon('Plus');
        const Star = getIcon('Star');

        // --- CLEAN INITIAL DATA ---
        // à¦à¦‡ à¦¡à¦¾à¦Ÿà¦¾à¦—à§à¦²à§‹ à¦¡à¦¿à¦«à¦²à§à¦Ÿ à¦¥à¦¾à¦•à¦¬à§‡, à¦•à¦¿à¦¨à§à¦¤à§ à¦²à§‹à¦•à¦¾à¦² à¦¸à§à¦Ÿà§‹à¦°à§‡à¦œà§‡ à¦¸à§‡à¦­ à¦¹à¦²à§‡ à¦…à§à¦¯à¦¾à¦¡à¦®à¦¿à¦¨ à¦ªà§à¦¯à¦¾à¦¨à§‡à¦²à§‡à¦° à¦¡à¦¾à¦Ÿà¦¾ à¦²à§‹à¦¡ à¦¹à¦¬à§‡
        const defaultServices = [
            { id: 1, name: "bKash Personal", type: "currency", unit_name: "BDT", buy_rate: 1, sell_rate: 1, reserve: 50000, min_limit: 50, max_limit: 25000, user_input_label: "Your bKash Number", payment_details: "01722051341 (Personal)", color: "bg-pink-600" },
            { id: 2, name: "Nagad Personal", type: "currency", unit_name: "BDT", buy_rate: 1, sell_rate: 1, reserve: 50000, min_limit: 50, max_limit: 25000, user_input_label: "Your Nagad Number", payment_details: "01722051341 (Personal)", color: "bg-orange-500" },
            { id: 3, name: "Telegram Stars", type: "account", unit_name: "Stars", buy_rate: 2.20, sell_rate: 2.80, reserve: 10000, min_limit: 15, max_limit: 5000, user_input_label: "Telegram Username", payment_details: "Contact Admin for User", color: "bg-blue-500" }
        ];

        const translations = {
            en: {
                nav_home: "Home", nav_track: "Track Order", nav_admin: "Admin",
                hero_title: "Fast Sell Exchange", hero_subtitle: "Instant Telegram Stars & Currency Exchange",
                send: "You Send", receive: "You Receive", reserve: "Reserve",
                exchange_btn: "Exchange Now", confirm_btn: "Confirm Order",
                rate_title: "Today's Rates", login_title: "Admin Login", dashboard_title: "Order History",
                admin_dash: "Dashboard", admin_orders: "Orders", admin_methods: "Methods", admin_settings: "Settings",
                step1: "Calculator", step2: "Payment", step3: "Done",
                pay_instruction: "Please send money to:", product_instruction: "Provide your account details:",
                trx_label: "TrxID / Number", product_label: "Details / Username"
            },
            bn: {
                nav_home: "à¦¹à§‹à¦®", nav_track: "à¦…à¦°à§à¦¡à¦¾à¦° à¦Ÿà§à¦°à§à¦¯à¦¾à¦•", nav_admin: "à¦à¦¡à¦®à¦¿à¦¨",
                hero_title: "à¦«à¦¾à¦¸à§à¦Ÿ à¦¸à§‡à¦² à¦à¦•à§à¦¸à¦šà§‡à¦žà§à¦œ", hero_subtitle: "à¦¦à§à¦°à§à¦¤ à¦Ÿà§‡à¦²à¦¿à¦—à§à¦°à¦¾à¦® à¦¸à§à¦Ÿà¦¾à¦° à¦à¦¬à¦‚ à¦•à¦¾à¦°à§‡à¦¨à§à¦¸à¦¿ à¦à¦•à§à¦¸à¦šà§‡à¦žà§à¦œ",
                send: "à¦†à¦ªà¦¨à¦¿ à¦ªà¦¾à¦ à¦¾à¦¬à§‡à¦¨", receive: "à¦†à¦ªà¦¨à¦¿ à¦ªà¦¾à¦¬à§‡à¦¨", reserve: "à¦®à¦œà§à¦¦",
                exchange_btn: "à¦à¦•à§à¦¸à¦šà§‡à¦žà§à¦œ à¦•à¦°à§à¦¨", confirm_btn: "à¦…à¦°à§à¦¡à¦¾à¦° à¦•à¦¨à¦«à¦¾à¦°à§à¦® à¦•à¦°à§à¦¨",
                rate_title: "à¦†à¦œà¦•à§‡à¦° à¦°à§‡à¦Ÿ", login_title: "à¦à¦¡à¦®à¦¿à¦¨ à¦²à¦—à¦‡à¦¨", dashboard_title: "à¦…à¦°à§à¦¡à¦¾à¦° à¦‡à¦¤à¦¿à¦¹à¦¾à¦¸",
                admin_dash: "à¦¡à§à¦¯à¦¾à¦¶à¦¬à§‹à¦°à§à¦¡", admin_orders: "à¦…à¦°à§à¦¡à¦¾à¦°", admin_methods: "à¦®à§‡à¦¥à¦¡", admin_settings: "à¦¸à§‡à¦Ÿà¦¿à¦‚à¦¸",
                step1: "à¦¹à¦¿à¦¸à¦¾à¦¬", step2: "à¦ªà§‡à¦®à§‡à¦¨à§à¦Ÿ", step3: "à¦¸à¦®à§à¦ªà¦¨à§à¦¨",
                pay_instruction: "à¦¨à¦¿à¦šà§‡à¦° à¦¨à¦¾à¦®à§à¦¬à¦¾à¦°à§‡ à¦Ÿà¦¾à¦•à¦¾ à¦ªà¦¾à¦ à¦¾à¦¨:", product_instruction: "à¦†à¦ªà¦¨à¦¾à¦° à¦¡à¦¿à¦Ÿà§‡à¦‡à¦²à¦¸ à¦¦à¦¿à¦¨:",
                trx_label: "TrxID / à¦¨à¦¾à¦®à§à¦¬à¦¾à¦°", product_label: "à¦¡à¦¿à¦Ÿà§‡à¦‡à¦²à¦¸ / à¦‡à¦‰à¦œà¦¾à¦°à¦¨à§‡à¦®"
            }
        };

        // --- APP COMPONENT ---
        function App() {
            // --- STATE MANAGEMENT WITH LOCAL STORAGE ---
            // Services
            const [services, setServices] = useState(() => {
                const saved = localStorage.getItem('fs_services');
                return saved ? JSON.parse(saved) : defaultServices;
            });

            // Orders
            const [orders, setOrders] = useState(() => {
                const saved = localStorage.getItem('fs_orders');
                return saved ? JSON.parse(saved) : [];
            });

            // Notice
            const [notice, setNotice] = useState(() => {
                return localStorage.getItem('fs_notice') || "ðŸŒŸ Welcome to Fast Sell! Buy/Sell Telegram Stars instantly via bKash/Nagad.";
            });

            // Save to LocalStorage whenever state changes
            useEffect(() => { localStorage.setItem('fs_services', JSON.stringify(services)); }, [services]);
            useEffect(() => { localStorage.setItem('fs_orders', JSON.stringify(orders)); }, [orders]);
            useEffect(() => { localStorage.setItem('fs_notice', notice); }, [notice]);

            // Sync across tabs
            useEffect(() => {
                const handleStorageChange = () => {
                    const savedServices = localStorage.getItem('fs_services');
                    const savedOrders = localStorage.getItem('fs_orders');
                    const savedNotice = localStorage.getItem('fs_notice');
                    if (savedServices) setServices(JSON.parse(savedServices));
                    if (savedOrders) setOrders(JSON.parse(savedOrders));
                    if (savedNotice) setNotice(savedNotice);
                };
                window.addEventListener('storage', handleStorageChange);
                return () => window.removeEventListener('storage', handleStorageChange);
            }, []);

            // UI States
            const [darkMode, setDarkMode] = useState(false);
            const [lang, setLang] = useState('bn');
            const [view, setView] = useState('home'); 
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            const [toasts, setToasts] = useState([]);
            const [isAdminLoggedIn, setIsAdminLoggedIn] = useState(false);
            const [loginUser, setLoginUser] = useState('');
            const [loginPass, setLoginPass] = useState('');

            // Exchange States
            const [exchangeStep, setExchangeStep] = useState(1);
            const [sendId, setSendId] = useState(services[0]?.id || 1);
            const [receiveId, setReceiveId] = useState(services[2]?.id || 3); // Default to Telegram Stars
            const [sendAmount, setSendAmount] = useState('');
            const [receiveAmount, setReceiveAmount] = useState('');
            const [userInput, setUserInput] = useState(''); 
            const [trxInput, setTrxInput] = useState(''); 

            // Admin States
            const [adminTab, setAdminTab] = useState('dashboard');
            const [showAddMethodForm, setShowAddMethodForm] = useState(false);
            const [showManualOrderForm, setShowManualOrderForm] = useState(false);

            const t = translations[lang];
            const sendService = services.find(s => s.id === parseInt(sendId)) || services[0];
            const receiveService = services.find(s => s.id === parseInt(receiveId)) || services[0];
            const adminWhatsApp = "8801722051341";

            // --- FUNCTIONS ---
            const addToast = (msg, type = 'success') => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, msg, type }]);
                setTimeout(() => setToasts(prev => prev.filter(t => t.id !== id)), 3000);
            };
            const removeToast = (id) => setToasts(prev => prev.filter(t => t.id !== id));
            const toggleTheme = () => setDarkMode(!darkMode);
            const toggleLang = () => setLang(lang === 'bn' ? 'en' : 'bn');

            const handleAdminLogin = (e) => {
                e.preventDefault();
                if(loginUser === 'bishal' && loginPass === 'bishal017') {
                    setIsAdminLoggedIn(true); setView('admin'); addToast("Welcome Admin!", "success");
                } else {
                    addToast("Wrong Info!", "error");
                }
            };

            const handleSendAmountChange = (val) => {
                setSendAmount(val);
                if (!val || isNaN(val)) { setReceiveAmount(''); return; }
                const baseValue = parseFloat(val) * sendService.buy_rate; 
                let estimatedReceive = baseValue / receiveService.sell_rate;
                if (receiveService.type !== 'currency') estimatedReceive = Math.floor(estimatedReceive); 
                else estimatedReceive = parseFloat(estimatedReceive.toFixed(4));
                setReceiveAmount(estimatedReceive);
            };

            const handleReceiveAmountChange = (val) => {
                if (receiveService.type !== 'currency' && val.includes('.')) return;
                setReceiveAmount(val);
                if (!val || isNaN(val)) { setSendAmount(''); return; }
                const requiredBase = parseFloat(val) * receiveService.sell_rate;
                let requiredSend = requiredBase / sendService.buy_rate;
                setSendAmount(parseFloat(requiredSend.toFixed(2)));
            };

            const handleSubmitOrder = () => {
                if(!trxInput || !userInput) { addToast("All fields required", "error"); return; }
                const newOrder = {
                    id: `ORD-${Math.floor(Math.random() * 9000) + 1000}`,
                    sendServiceId: sendService.id, receiveServiceId: receiveService.id,
                    sendAmount: sendAmount, receiveAmount: receiveAmount,
                    userData: userInput, trxId: trxInput, status: "pending", deliveryData: "",
                    date: new Date().toLocaleString()
                };
                setOrders([newOrder, ...orders]);
                setView('dashboard'); setUserInput(''); setTrxInput(''); setSendAmount(''); setReceiveAmount(''); setExchangeStep(1);
                addToast("Order Placed!", "success");
            };

            const handleAddService = (e) => {
                e.preventDefault();
                const fd = new FormData(e.target);
                const newService = {
                    id: Date.now(),
                    name: fd.get('name'), type: fd.get('type'), unit_name: fd.get('unit'),
                    buy_rate: parseFloat(fd.get('rate')), sell_rate: parseFloat(fd.get('rate')) * 1.1,
                    reserve: 0, min_limit: 1, max_limit: 10000,
                    user_input_label: fd.get('label'), payment_details: fd.get('payment'), color: "bg-slate-500"
                };
                setServices([...services, newService]); setShowAddMethodForm(false);
                addToast("Method Added!", "success");
            };

            const handleOrderAction = (id, action, data = null) => {
                setOrders(prev => prev.map(o => {
                    if (o.id !== id) return o;
                    if (action === 'deliver') return { ...o, status: 'completed', deliveryData: data };
                    if (action === 'cancel') return { ...o, status: 'cancelled' };
                    if (action === 'update_send') return { ...o, sendAmount: data };
                    if (action === 'update_receive') return { ...o, receiveAmount: data };
                    return o;
                }));
                if(action === 'deliver' || action === 'cancel') addToast(`Order ${action}ed!`, action === 'cancel' ? 'error' : 'success');
            };

            const openWhatsApp = () => window.open(`https://wa.me/${adminWhatsApp}`, '_blank');

            return (
                <div className={`min-h-screen transition-colors duration-300 font-sans ${darkMode ? 'bg-slate-900 text-slate-100' : 'bg-slate-50 text-slate-800'}`}>
                    
                    {/* Toasts */}
                    <div className="z-[100] fixed top-4 right-4 space-y-2">
                        {toasts.map(t => (
                            <div key={t.id} className={`flex items-center gap-2 px-4 py-3 rounded-lg shadow-xl animate-fade-in ${t.type === 'success' ? 'bg-green-600 text-white' : 'bg-red-600 text-white'}`}>
                                <span>{t.msg}</span>
                                <button onClick={() => removeToast(t.id)}><X size={14}/></button>
                            </div>
                        ))}
                    </div>

                    {/* Navbar */}
                    <nav className={`sticky top-0 z-50 backdrop-blur-md border-b ${darkMode ? 'bg-slate-900/80 border-slate-700' : 'bg-white/80 border-slate-200'}`}>
                        <div className="max-w-6xl mx-auto px-4 h-16 flex justify-between items-center">
                            <div className="flex items-center gap-2 cursor-pointer" onClick={() => setView('home')}>
                                <div className="bg-indigo-600 text-white p-2 rounded-lg"><ArrowRightLeft size={20}/></div>
                                <div><h1 className="font-black text-xl leading-none">Fast Sell</h1><p className="text-[10px] opacity-60">Trusted Exchange</p></div>
                            </div>
                            <div className="hidden md:flex gap-2">
                                <button onClick={() => setView('home')} className={`px-4 py-2 rounded-lg text-sm font-bold ${view==='home'?'bg-indigo-600 text-white':'hover:bg-slate-200 text-slate-600'}`}>{t.nav_home}</button>
                                <button onClick={() => setView('dashboard')} className={`px-4 py-2 rounded-lg text-sm font-bold ${view==='dashboard'?'bg-indigo-600 text-white':'hover:bg-slate-200 text-slate-600'}`}>{t.nav_track}</button>
                                <button onClick={() => setView(isAdminLoggedIn ? 'admin' : 'login')} className={`px-4 py-2 rounded-lg text-sm font-bold ${view==='admin'?'bg-indigo-600 text-white':'hover:bg-slate-200 text-slate-600'}`}>{isAdminLoggedIn ? 'Admin' : t.nav_admin}</button>
                            </div>
                            <div className="flex gap-2 items-center">
                                <button onClick={toggleLang} className="p-2 border rounded-lg text-xs font-bold">{lang === 'bn' ? 'EN' : 'BN'}</button>
                                <button onClick={toggleTheme} className="p-2 rounded-lg bg-slate-200 dark:bg-slate-700">{darkMode ? <Sun size={16}/> : <Moon size={16}/>}</button>
                                <button className="md:hidden p-2" onClick={() => setMobileMenuOpen(!mobileMenuOpen)}><Menu size={20}/></button>
                            </div>
                        </div>
                        {mobileMenuOpen && (
                            <div className="md:hidden p-4 border-t space-y-2 bg-white dark:bg-slate-800">
                                <button onClick={()=>{setView('home');setMobileMenuOpen(false)}} className="block w-full text-left p-2 font-bold">{t.nav_home}</button>
                                <button onClick={()=>{setView('dashboard');setMobileMenuOpen(false)}} className="block w-full text-left p-2 font-bold">{t.nav_track}</button>
                                <button onClick={()=>{setView(isAdminLoggedIn?'admin':'login');setMobileMenuOpen(false)}} className="block w-full text-left p-2 font-bold">{t.nav_admin}</button>
                            </div>
                        )}
                    </nav>

                    {/* Notice */}
                    <div className="bg-indigo-50 dark:bg-slate-800 border-b border-indigo-100 dark:border-slate-700 py-2 overflow-hidden">
                        <div className="whitespace-nowrap animate-marquee text-sm font-medium text-indigo-600 dark:text-indigo-400 flex gap-8">
                            <span>ðŸ“¢ {notice}</span>
                            {services.map(s => <span key={s.id}>{s.name}: {s.reserve} {s.unit_name}</span>)}
                        </div>
                    </div>

                    <main className="max-w-6xl mx-auto px-4 py-8">
                        {/* HOME */}
                        {view === 'home' && (
                            <div className="grid lg:grid-cols-12 gap-8">
                                <div className="lg:col-span-7 space-y-6">
                                    <div className={`rounded-3xl shadow-xl border overflow-hidden ${darkMode?'bg-slate-800 border-slate-700':'bg-white border-slate-100'}`}>
                                        <div className="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white">
                                            <h2 className="text-2xl font-black">{t.hero_title}</h2>
                                            <p className="text-indigo-200 text-sm">{t.hero_subtitle}</p>
                                        </div>
                                        <div className="p-6 space-y-6">
                                            {exchangeStep === 1 ? (
                                                <div className="space-y-4 animate-fade-in">
                                                    <div className="bg-slate-50 dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-700">
                                                        <div className="flex justify-between text-xs font-bold uppercase text-slate-500 mb-2"><span>{t.send}</span><span>Reserve: {sendService.reserve}</span></div>
                                                        <div className="flex gap-2">
                                                            <select className="bg-transparent font-bold w-1/3 outline-none" value={sendId} onChange={e=>{setSendId(e.target.value);setSendAmount('');setReceiveAmount('')}}>{services.map(s=><option key={s.id} value={s.id}>{s.name}</option>)}</select>
                                                            <input type="number" placeholder="0.00" className="w-2/3 bg-transparent text-right font-mono text-xl outline-none" value={sendAmount} onChange={e=>handleSendAmountChange(e.target.value)}/>
                                                        </div>
                                                    </div>
                                                    <div className="flex justify-center -my-6 relative z-10"><div className="bg-indigo-600 text-white p-2 rounded-full border-4 border-white dark:border-slate-800"><ArrowRightLeft size={16}/></div></div>
                                                    <div className="bg-slate-50 dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-700">
                                                        <div className="flex justify-between text-xs font-bold uppercase text-slate-500 mb-2"><span>{t.receive}</span><span>Reserve: {receiveService.reserve}</span></div>
                                                        <div className="flex gap-2">
                                                            <select className="bg-transparent font-bold w-1/3 outline-none" value={receiveId} onChange={e=>{setReceiveId(e.target.value);setSendAmount('');setReceiveAmount('')}}>{services.map(s=><option key={s.id} value={s.id}>{s.name}</option>)}</select>
                                                            <input type="number" placeholder="0.00" className="w-2/3 bg-transparent text-right font-mono text-xl outline-none" value={receiveAmount} onChange={e=>handleReceiveAmountChange(e.target.value)}/>
                                                        </div>
                                                    </div>
                                                    <div className="p-4 rounded-xl border border-indigo-200 bg-indigo-50 dark:bg-indigo-900/20">
                                                        <label className="block text-xs font-bold text-indigo-600 mb-1">{receiveService.user_input_label} *</label>
                                                        <input type="text" className="w-full bg-transparent outline-none font-medium" placeholder="Type here..." value={userInput} onChange={e=>setUserInput(e.target.value)}/>
                                                    </div>
                                                    <button onClick={()=>{if(!sendAmount||!userInput)return addToast("Fill all fields","error"); setExchangeStep(2)}} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-xl shadow-lg transition">{t.exchange_btn}</button>
                                                </div>
                                            ) : (
                                                <div className="space-y-4 animate-fade-in">
                                                    <div className="bg-yellow-50 border border-yellow-200 p-4 rounded-xl text-yellow-800">
                                                        <h4 className="font-bold flex gap-2 items-center mb-2"><Wallet size={16}/> {t.pay_instruction}</h4>
                                                        <div className="bg-white p-2 rounded border border-yellow-100 font-mono text-sm flex justify-between items-center">
                                                            <span>{sendService.payment_details}</span>
                                                            <button onClick={()=>navigator.clipboard.writeText(sendService.payment_details)}><Copy size={14}/></button>
                                                        </div>
                                                        <p className="text-xs mt-2">Send exactly <b>{sendAmount} {sendService.unit_name}</b> here.</p>
                                                    </div>
                                                    <div className="p-4 rounded-xl border border-slate-200 dark:border-slate-700">
                                                        <label className="block text-xs font-bold text-slate-500 mb-1">{t.trx_label} / {t.product_label} *</label>
                                                        <input type="text" className="w-full bg-transparent outline-none" placeholder="Enter transaction info..." value={trxInput} onChange={e=>setTrxInput(e.target.value)}/>
                                                    </div>
                                                    <div className="flex gap-3">
                                                        <button onClick={()=>setExchangeStep(1)} className="w-1/3 bg-slate-200 text-slate-700 font-bold py-3 rounded-xl">Back</button>
                                                        <button onClick={handleSubmitOrder} className="w-2/3 bg-green-600 text-white font-bold py-3 rounded-xl shadow-lg">{t.confirm_btn}</button>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                                <div className="lg:col-span-5 space-y-6">
                                    <div className={`p-6 rounded-3xl border shadow-sm ${darkMode?'bg-slate-800 border-slate-700':'bg-white border-slate-100'}`}>
                                        <h3 className="font-bold mb-4 flex items-center gap-2"><Package size={18}/> {t.rate_title}</h3>
                                        <div className="space-y-2">
                                            {services.map(s => (
                                                <div key={s.id} className="flex justify-between items-center p-3 rounded-lg bg-slate-50 dark:bg-slate-700/50">
                                                    <div className="flex items-center gap-2">
                                                        <div className={`w-2 h-8 rounded-full ${s.color}`}></div>
                                                        <span className="font-medium text-sm">{s.name}</span>
                                                    </div>
                                                    <div className="text-right">
                                                        <div className="font-bold text-sm">{s.sell_rate} à§³</div>
                                                        <div className="text-[10px] opacity-60">Stock: {s.reserve}</div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="bg-indigo-600 text-white p-6 rounded-3xl shadow-lg text-center">
                                        <h4 className="font-bold mb-2">Need Support?</h4>
                                        <button onClick={openWhatsApp} className="bg-white text-indigo-600 px-6 py-2 rounded-full font-bold text-sm flex items-center gap-2 mx-auto"><MessageCircle size={16}/> WhatsApp Admin</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* DASHBOARD */}
                        {view === 'dashboard' && (
                            <div className={`rounded-3xl shadow-lg border overflow-hidden min-h-[60vh] ${darkMode?'bg-slate-800 border-slate-700':'bg-white border-slate-100'}`}>
                                <div className="p-6 bg-slate-100 dark:bg-slate-900 border-b dark:border-slate-700"><h2 className="font-bold text-xl">{t.dashboard_title}</h2></div>
                                <div className="p-6 space-y-4">
                                    {orders.length === 0 ? <p className="text-center opacity-50">No orders yet.</p> : orders.map(o => (
                                        <div key={o.id} className="p-4 border rounded-xl hover:shadow-md transition dark:border-slate-700">
                                            <div className="flex justify-between mb-2">
                                                <span className="text-xs font-bold bg-slate-200 dark:bg-slate-700 px-2 py-1 rounded">{o.id}</span>
                                                <span className={`text-xs font-bold px-2 py-1 rounded uppercase ${o.status==='completed'?'bg-green-100 text-green-700':o.status==='cancelled'?'bg-red-100 text-red-700':'bg-orange-100 text-orange-700'}`}>{o.status}</span>
                                            </div>
                                            <div className="font-bold flex items-center gap-2 text-sm">
                                                <span className="text-red-500">{o.sendAmount} {services.find(s=>s.id===o.sendServiceId)?.unit_name}</span>
                                                <ArrowRight size={14} className="opacity-50"/>
                                                <span className="text-green-500">{o.receiveAmount} {services.find(s=>s.id===o.receiveServiceId)?.unit_name}</span>
                                            </div>
                                            {o.deliveryData && <div className="mt-2 bg-green-50 p-2 rounded text-xs text-green-800 font-mono border border-green-200">Received: {o.deliveryData}</div>}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* ADMIN */}
                        {view === 'admin' && isAdminLoggedIn && (
                            <div className="grid md:grid-cols-4 gap-6 animate-fade-in">
                                <div className={`md:col-span-1 rounded-2xl p-4 h-fit border shadow-sm ${darkMode?'bg-slate-800 border-slate-700':'bg-white border-slate-200'}`}>
                                    <div className="space-y-1">
                                        {['dashboard','orders','methods','settings'].map(tab => (
                                            <button key={tab} onClick={()=>setAdminTab(tab)} className={`w-full text-left px-4 py-3 rounded-xl text-sm font-bold capitalize ${adminTab===tab?'bg-indigo-600 text-white':'hover:bg-slate-100 dark:hover:bg-slate-700'}`}>{translations.en[`admin_${tab}`]}</button>
                                        ))}
                                        <button onClick={()=>{setIsAdminLoggedIn(false);setView('home')}} className="w-full text-left px-4 py-3 rounded-xl text-sm font-bold text-red-500 hover:bg-red-50 mt-4">Logout</button>
                                    </div>
                                </div>
                                <div className="md:col-span-3 space-y-6">
                                    {adminTab === 'dashboard' && (
                                        <div className="grid grid-cols-3 gap-4">
                                            {[{l:'Total',v:orders.length,c:'bg-blue-500'},{l:'Pending',v:orders.filter(o=>o.status==='pending').length,c:'bg-orange-500'},{l:'Done',v:orders.filter(o=>o.status==='completed').length,c:'bg-green-500'}].map((s,i)=>(
                                                <div key={i} className={`${s.c} text-white p-6 rounded-2xl shadow-lg`}>
                                                    <div className="text-xs opacity-80 uppercase">{s.l}</div>
                                                    <div className="text-3xl font-black">{s.v}</div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                    {adminTab === 'orders' && (
                                        <div className="space-y-4">
                                            {orders.map(o => (
                                                <div key={o.id} className={`p-4 rounded-xl border relative bg-white dark:bg-slate-800 ${o.status==='pending'?'border-orange-400':'dark:border-slate-700'}`}>
                                                    <div className="flex justify-between items-start mb-3">
                                                        <div><span className="font-bold text-sm text-indigo-600">#{o.id}</span> <span className="text-xs opacity-50">{o.date}</span></div>
                                                        <div className="flex gap-2">
                                                            {o.status==='pending' && <button onClick={()=>handleOrderAction(o.id,'cancel')} className="bg-red-100 text-red-600 px-2 py-1 rounded text-xs font-bold">Cancel</button>}
                                                            <span className="text-xs font-bold bg-slate-100 px-2 py-1 rounded uppercase">{o.status}</span>
                                                        </div>
                                                    </div>
                                                    <div className="grid grid-cols-2 gap-4 text-sm mb-3">
                                                        <div>
                                                            <label className="text-[10px] font-bold opacity-50 block">USER SENT</label>
                                                            {o.status==='pending' ? <input type="number" className="font-bold text-red-500 w-full bg-transparent border-b outline-none" value={o.sendAmount} onChange={e=>handleOrderAction(o.id,'update_send',e.target.value)}/> : <span className="font-bold text-red-500">{o.sendAmount}</span>}
                                                            <span className="text-xs ml-1">{services.find(s=>s.id===o.sendServiceId)?.name}</span>
                                                        </div>
                                                        <div className="text-right">
                                                            <label className="text-[10px] font-bold opacity-50 block">USER GETS</label>
                                                            {o.status==='pending' ? <input type="number" className="font-bold text-green-500 w-full bg-transparent border-b outline-none text-right" value={o.receiveAmount} onChange={e=>handleOrderAction(o.id,'update_receive',e.target.value)}/> : <span className="font-bold text-green-500">{o.receiveAmount}</span>}
                                                            <span className="text-xs ml-1">{services.find(s=>s.id===o.receiveServiceId)?.name}</span>
                                                        </div>
                                                    </div>
                                                    <div className="bg-slate-50 dark:bg-slate-900 p-2 rounded text-xs mb-2">
                                                        <div><b>User:</b> {o.userData}</div>
                                                        <div><b>Proof:</b> {o.trxId}</div>
                                                    </div>
                                                    {o.status === 'pending' && (
                                                        <div className="flex gap-2">
                                                            <input id={`d-${o.id}`} type="text" placeholder="Delivery Data (Secret)" className="flex-1 border p-2 rounded text-xs outline-none"/>
                                                            <button onClick={()=>{const d=document.getElementById(`d-${o.id}`).value; if(d) handleOrderAction(o.id,'deliver',d)}} className="bg-green-600 text-white px-4 py-2 rounded text-xs font-bold">Approve</button>
                                                        </div>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                    {adminTab === 'methods' && (
                                        <div className="space-y-4">
                                            {services.map(s => (
                                                <div key={s.id} className="p-4 border rounded-xl flex justify-between items-center bg-white dark:bg-slate-800 dark:border-slate-700">
                                                    <div>
                                                        <div className="font-bold">{s.name} <span className="text-xs opacity-60">({s.type})</span></div>
                                                        <div className="text-xs opacity-60">Buy: {s.buy_rate} | Sell: {s.sell_rate} | Reserve: {s.reserve}</div>
                                                    </div>
                                                    <button onClick={()=>{if(confirm('Delete?')) setServices(services.filter(x=>x.id!==s.id))}} className="text-red-500"><Trash2 size={16}/></button>
                                                </div>
                                            ))}
                                            <div className="border-2 border-dashed p-4 rounded-xl text-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800" onClick={()=>setShowAddMethodForm(!showAddMethodForm)}>
                                                <span className="font-bold text-indigo-500">+ Add Method</span>
                                            </div>
                                            {showAddMethodForm && (
                                                <form onSubmit={handleAddService} className="p-4 border rounded-xl space-y-3 bg-white dark:bg-slate-800">
                                                    <input name="name" placeholder="Name" required className="w-full p-2 border rounded text-sm"/>
                                                    <div className="grid grid-cols-2 gap-2">
                                                        <select name="type" className="p-2 border rounded text-sm"><option value="currency">Currency</option><option value="account">Account</option></select>
                                                        <input name="unit" placeholder="Unit" required className="p-2 border rounded text-sm"/>
                                                    </div>
                                                    <input name="rate" type="number" placeholder="Rate" required className="w-full p-2 border rounded text-sm"/>
                                                    <input name="label" placeholder="User Input Label" required className="w-full p-2 border rounded text-sm"/>
                                                    <input name="payment" placeholder="Our Payment Details" required className="w-full p-2 border rounded text-sm"/>
                                                    <button className="w-full bg-green-600 text-white py-2 rounded text-sm font-bold">Save Method</button>
                                                </form>
                                            )}
                                        </div>
                                    )}
                                    {adminTab === 'settings' && (
                                        <div className="p-6 border rounded-xl bg-white dark:bg-slate-800 dark:border-slate-700">
                                            <h3 className="font-bold mb-2">Website Notice</h3>
                                            <textarea className="w-full p-3 border rounded-lg text-sm mb-3 h-24 outline-none dark:bg-slate-900" value={notice} onChange={e=>setNotice(e.target.value)}></textarea>
                                            <button className="bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold text-sm">Save Notice</button>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* ADMIN LOGIN */}
                        {view === 'login' && (
                            <div className="max-w-md mx-auto mt-20 p-8 rounded-3xl shadow-2xl border dark:border-slate-700 bg-white dark:bg-slate-800 text-center">
                                <h2 className="text-2xl font-black mb-6">Admin Access</h2>
                                <form onSubmit={handleAdminLogin} className="space-y-4">
                                    <input type="text" placeholder="Username" className="w-full p-3 rounded-xl border outline-none" value={loginUser} onChange={e=>setLoginUser(e.target.value)}/>
                                    <input type="password" placeholder="Password" className="w-full p-3 rounded-xl border outline-none" value={loginPass} onChange={e=>setLoginPass(e.target.value)}/>
                                    <button className="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold">Login Dashboard</button>
                                </form>
                            </div>
                        )}
                    </main>

                    <footer className="text-center py-8 text-xs opacity-50">&copy; 2024 Fast Sell Exchange</footer>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
